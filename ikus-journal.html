<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/svg+xml" href="iku.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iku's journal</title>
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* 1. LAYOUT RESET & FIX */
        body { 
            display: block !important; /* Overrides the centering flex from style.css */
            overflow-y: auto !important;
            padding-bottom: 100px;
        }

        .title-header { width: 100%; text-align: center; padding: 80px 20px 40px 20px; }
        h1 { margin: 0; font-weight: 200; letter-spacing: 8px; text-transform: lowercase; font-size: 2.2rem; color: #ffffff !important; opacity: 0.9; }
        
        .journal-container { max-width: 1400px; width: 92%; margin: 0 auto; }
        
        #editorArea { margin-bottom: 60px; max-width: 800px; margin-left: auto; margin-right: auto; }
        textarea#note {
            width: 100%; padding: 25px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.1); 
            background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            color: #fff; font-family: 'Georgia', serif; font-size: 18px; resize: none; outline: none;
            line-height: 1.6;
        }
        #saveBtn { width: 100%; margin-top: 20px; border-radius: 50px; font-weight: 800; padding: 16px; background: white; color: black; border: none; cursor: pointer; letter-spacing: 1px; transition: 0.3s; }

        /* 2. THE DREAMY EXPANSION SYSTEM */
        #entries {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            align-items: flex-start;
        }

        .journal-entry { 
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 28px;
            border-radius: 30px; 
            position: relative; 
            width: 340px; 
            min-height: 140px;
            cursor: pointer; 
            overflow: hidden;
            transition: 
                width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), 
                transform 0.8s cubic-bezier(0.22, 1, 0.36, 1),
                background 0.8s ease,
                opacity 0.6s ease,
                filter 0.6s ease;
        }
        
        /* Sideways Expansion on Hover */
        .journal-entry:hover {
            width: 500px;
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-8px);
            z-index: 10;
        }

        /* Neighbor blur effect */
        #entries:has(.journal-entry:hover) .journal-entry:not(:hover) {
            opacity: 0.4;
            filter: blur(3px);
            transform: scale(0.96);
        }

        /* 3. SMOOTH CONTENT UNROLLING */
        .entry-content { 
            max-height: 0; 
            opacity: 0;
            overflow: hidden;
            margin-top: 0;
            white-space: pre-wrap; 
            font-family: 'Georgia', serif; 
            line-height: 1.8; 
            color: rgba(255,255,255,0.75); 
            font-size: 1.05rem;
            transition: max-height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s ease, margin-top 0.5s ease;
        }

        .journal-entry.expanded { 
            width: 100% !important; 
            max-width: 1100px; 
            cursor: default;
        }

        .journal-entry.expanded .entry-content { 
            max-height: 1500px; 
            opacity: 1;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.08);
        }

        /* TYPOGRAPHY & ICONS */
        .entry-title { font-weight: 600; font-size: 1.25rem; color: #ffffff; margin-bottom: 8px; display: block; }
        .entry-date { font-size: 0.75rem; color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 1.5px; }
        .expand-icon { position: absolute; right: 28px; top: 30px; font-size: 1.4rem; color: rgba(255,255,255,0.2); transition: 0.8s; }
        .expanded .expand-icon { transform: rotate(45deg); color: #fff; }
        .delete-btn { position: absolute; bottom: 20px; right: 25px; color: #ff5555; background: rgba(255,0,0,0.1); border: 1px solid rgba(255, 85, 85, 0.3); border-radius: 12px; padding: 6px 12px; display: none; }
        .expanded .delete-btn { display: block; }

        @media (max-width: 650px) { .journal-entry { width: 100%; } .journal-entry:hover { width: 100%; } }
    </style>
</head>
<body>

    <div class="title-header"><h1>iku's journal</h1></div>
    
    <div class="journal-container">
        <div id="editorArea" style="display:none;">
            <textarea id="note" rows="5" placeholder="Headline...&#10;&#10;Your story begins here..."></textarea>
            <button id="saveBtn">POST ENTRY</button>
        </div>
        <div id="entries"></div>
    </div>

    <div id="bottomControls">
        <a class="icon-btn" href="index.html">üè† HOME</a>
        <button id="showLoginBtn" class="lock-btn">üîí</button>
        <div id="loginPopup">
            <input type="email" id="emailInput" placeholder="email">
            <input type="password" id="passInput" placeholder="password">
            <button id="performLoginBtn" style="background:white; color:black; border:none; padding:12px; border-radius:15px; font-weight:bold; cursor:pointer;">SIGN IN</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBdkI7GUPRJsxLtBlp9gaQNlR7nz-JDi2g", 
            authDomain: "iku-website-iku.firebaseapp.com",
            databaseURL: "https://iku-website-iku-default-rtdb.asia-southeast1.firebasedatabase.app", 
            projectId: "iku-website-iku" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        let isAdmin = false;

        onAuthStateChanged(auth, (user) => {
            isAdmin = !!user;
            document.getElementById('editorArea').style.display = isAdmin ? 'block' : 'none';
            document.getElementById('showLoginBtn').innerHTML = isAdmin ? 'üîì' : 'üîí';
        });

        onValue(ref(db, 'entries'), (snapshot) => {
            const list = document.getElementById('entries');
            list.innerHTML = '';
            const data = snapshot.val();
            if (data) {
                Object.keys(data).reverse().forEach(key => {
                    const entry = data[key];
                    const lines = entry.text.split('\n');
                    const titleText = lines[0];
                    const bodyText = lines.slice(1).join('\n').trim();

                    const div = document.createElement('div');
                    div.className = 'journal-entry';
                    div.innerHTML = `
                        <span class="expand-icon">+</span>
                        <span class="entry-title">${titleText}</span>
                        <div class="entry-date">${new Date(entry.date).toLocaleDateString()}</div>
                        <div class="entry-content">${bodyText || "..." }</div>
                        ${isAdmin ? '<button class="delete-btn">DELETE</button>' : ''}
                    `;

                    div.addEventListener('click', (e) => {
                        if (e.target.classList.contains('delete-btn')) return;
                        div.classList.toggle('expanded');
                    });

                    if (isAdmin) {
                        div.querySelector('.delete-btn').addEventListener('click', (e) => {
                            e.stopPropagation();
                            if (confirm("Delete?")) remove(ref(db, `entries/${key}`));
                        });
                    }
                    list.appendChild(div);
                });
            }
        });

        document.getElementById('showLoginBtn').addEventListener('click', () => {
            const p = document.getElementById('loginPopup');
            p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
        });

        document.getElementById('performLoginBtn').addEventListener('click', async () => {
            try {
                await signInWithEmailAndPassword(auth, document.getElementById('emailInput').value, document.getElementById('passInput').value);
                window.location.reload(); 
            } catch (e) { alert("Error"); }
        });

        document.getElementById('saveBtn').addEventListener('click', () => {
            const ta = document.getElementById('note');
            if (ta.value.trim()) {
                push(ref(db, 'entries'), { date: new Date().toISOString(), text: ta.value });
                ta.value = '';
            }
        });
    </script>
</body>
</html>
